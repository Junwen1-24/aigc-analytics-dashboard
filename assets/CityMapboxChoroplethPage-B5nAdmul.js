import"./transform-oW_9wQLA.js";import{m as w}from"./mapbox-gl-BKwbCUZc.js";import{_ as P,r as B,o as R,a as J,c as y,d as m,h as S,F as U,f as V,n as q,t as D,e as C,g as F}from"./index-BlnXBglW.js";import{g as T,z as H,m as I,B as k}from"./YlOrRd-BLDl4Kwt.js";import{m as z}from"./min-DjRpVu9I.js";import{c as G}from"./dsv-XhNTmijJ.js";import{a as W}from"./area-BAqHKHE7.js";function Z(o=T){if(o===T)return A;if(typeof o!="function")throw new TypeError("compare is not a function");return(e,t)=>{const n=o(e,t);return n||n===0?n:(o(t,t)===0)-(o(e,e)===0)}}function A(o,e){return(o==null||!(o>=o))-(e==null||!(e>=e))||(o<e?-1:o>e?1:0)}function j(o,e,t=0,n=1/0,l){if(e=Math.floor(e),t=Math.floor(Math.max(0,t)),n=Math.floor(Math.min(o.length-1,n)),!(t<=e&&e<=n))return o;for(l=l===void 0?A:Z(l);n>t;){if(n-t>600){const b=n-t+1,u=e-t+1,r=Math.log(b),s=.5*Math.exp(2*r/3),h=.5*Math.sqrt(r*s*(b-s)/b)*(u-b/2<0?-1:1),M=Math.max(t,Math.floor(e-u*s/b+h)),g=Math.min(n,Math.floor(e+(b-u)*s/b+h));j(o,e,M,g,l)}const p=o[e];let f=t,i=n;for(x(o,t,e),l(o[n],p)>0&&x(o,t,n);f<i;){for(x(o,f,i),++f,--i;l(o[f],p)<0;)++f;for(;l(o[i],p)>0;)--i}l(o[t],p)===0?x(o,t,i):(++i,x(o,i,n)),i<=e&&(t=i+1),e<=i&&(n=i-1)}return o}function x(o,e,t){const n=o[e];o[e]=o[t],o[t]=n}function K(o,e,t){if(o=Float64Array.from(H(o)),!(!(n=o.length)||isNaN(e=+e))){if(e<=0||n<2)return z(o);if(e>=1)return I(o);var n,l=(n-1)*e,p=Math.floor(l),f=I(j(o,p).subarray(0,p+1)),i=z(o.subarray(p+1));return f+(i-f)*(l-p)}}const Q={class:"map-card"},X={class:"map-frame","aria-label":"Mapbox choropleth map"},Y={key:0,class:"map-legend","aria-hidden":"true"},oo={class:"legend-label"},eo={__name:"MapboxNeighborhoodChoropleth",setup(o){w.accessToken="pk.eyJ1IjoianVud2VuMS0yNCIsImEiOiJjbWhhOTB0OXgxaHhoMmxwdWFuajg0dTg4In0._dlzG_ciC_aQKohMPH9MbA";const e=B(null),t=B([]);let n,l;const p=u=>({...u,features:u.features.map(s=>{var M;if(((M=s.geometry)==null?void 0:M.type)!=="MultiPolygon")return s;const h=s.geometry.coordinates.filter(g=>W({type:"Polygon",coordinates:g})<10);return h.length&&h.length!==s.geometry.coordinates.length?{...s,geometry:{...s.geometry,coordinates:h}}:s}).filter(Boolean)}),f=u=>{const r=new Map;return u.forEach(s=>{const h=s.neighborhood?s.neighborhood.trim():"";h&&r.set(h,(r.get(h)??0)+1)}),r},i=u=>{const r=u.filter(a=>a>0).sort((a,c)=>a-c),s=k[6];if(!r.length)return{expression:null,legend:[{label:"0",color:"#e2e8f0"}]};const h=Math.min(s.length-1,r.length),M=[];for(let a=1;a<=h;a+=1){const c=K(r,a/(h+1));c&&c>0&&M.push(Math.round(c))}const g=Array.from(new Set(M)).filter(a=>a>0).sort((a,c)=>a-c),_=["step",["get","complaints"],s[0]],d=[{label:"0",color:s[0]}];if(!g.length){const a=Math.max(1,r[0]);return _.push(a,s[1]),d.push({label:`≥ ${a}`,color:s[1]}),{expression:_,legend:d}}return g.forEach((a,c)=>{const v=s[Math.min(c+1,s.length-1)];_.push(a,v),d.push({label:`≥ ${a}`,color:v})}),{expression:_,legend:d}},b=async()=>{if(!e.value)return;const u=new URL("/aigc-analytics-dashboard/assets/LA_Times_Neighborhood_Boundaries-BcCkABjd.geojson",import.meta.url),r=new URL("/aigc-analytics-dashboard/assets/complaints-C3JJk2yc.csv",import.meta.url),[s,h]=await Promise.all([fetch(u).then(d=>d.json()),G(r,d=>({neighborhood:d.neighborhood?d.neighborhood.trim():""}))]),M=f(h),g=p(s),_=[];g.features=g.features.map(d=>{var v;const a=((v=d.properties)==null?void 0:v.name)??"",c=M.get(a)??0;return _.push(c),{...d,properties:{...d.properties,complaints:c}}}),n=new w.Map({container:e.value,style:"mapbox://styles/mapbox/light-v11",center:[-118.27,34.01],zoom:9.4,minZoom:8.5,maxZoom:13}),n.on("load",()=>{const{expression:d,legend:a}=i(_);t.value=a,n.addSource("la-neighborhoods",{type:"geojson",data:g,promoteId:"OBJECTID"}),n.addLayer({id:"la-neighborhoods-fill",type:"fill",source:"la-neighborhoods",paint:{"fill-color":d??"#e2e8f0","fill-opacity":.85}}),n.addLayer({id:"la-neighborhoods-outline",type:"line",source:"la-neighborhoods",paint:{"line-color":"#1f2937","line-width":.6}});const c=new w.Popup({closeButton:!1,closeOnClick:!1});n.on("mousemove","la-neighborhoods-fill",v=>{var N;n.getCanvas().style.cursor="pointer";const L=(N=v.features)==null?void 0:N[0];if(!L){c.remove();return}const{name:E,complaints:O}=L.properties??{},$=`<strong>${E??"Neighborhood"}</strong><br/>Complaints: ${O??0}`;c.setLngLat(v.lngLat).setHTML($).addTo(n)}),n.on("mouseleave","la-neighborhoods-fill",()=>{n.getCanvas().style.cursor="",c.remove()})})};return R(async()=>{await b(),e.value&&(l=new ResizeObserver(()=>{n&&n.resize()}),l.observe(e.value))}),J(()=>{l&&e.value&&l.unobserve(e.value),n&&(n.remove(),n=null)}),(u,r)=>(C(),y("section",Q,[r[1]||(r[1]=m("header",{class:"map-card__header"},[m("div",null,[m("h2",{class:"h5 mb-1"},"Mapbox Choropleth · LA Neighborhood Complaints"),m("p",{class:"text-muted mb-0"}," Neighborhoods shaded by 2024 LA 311 environmental complaints. Hover a polygon for totals. ")])],-1)),m("div",X,[m("div",{ref_key:"mapContainer",ref:e,class:"mapbox-surface"},null,512),t.value.length?(C(),y("div",Y,[r[0]||(r[0]=m("p",{class:"legend-title"},"Complaints",-1)),(C(!0),y(U,null,V(t.value,s=>(C(),y("div",{key:s.label,class:"legend-item"},[m("span",{class:"legend-swatch",style:q({backgroundColor:s.color})},null,4),m("span",oo,D(s.label),1)]))),128))])):S("",!0)])]))}},no=P(eo,[["__scopeId","data-v-85d52e00"]]),to={class:"container"},uo={__name:"CityMapboxChoroplethPage",setup(o){return(e,t)=>(C(),y("div",to,[t[0]||(t[0]=m("header",{class:"mb-4"},[m("h1",{class:"h3 fw-semibold mb-1"},"Mapbox Neighborhood Choropleth"),m("p",{class:"text-muted mb-0"}," Interactive Mapbox GL choropleth shading Los Angeles neighborhoods by the volume of 2024 environmental complaints. ")],-1)),F(no)]))}};export{uo as default};
