import"./transform-oW_9wQLA.js";import{_ as T,r as M,o as D,a as O,c as L,d as f,e as R,g as E}from"./index-BlnXBglW.js";import{p as Y,r as q,i as H,s as v,b as P,d as K}from"./sequential-koWqMJEX.js";import{c as I}from"./dsv-XhNTmijJ.js";import{t as Q,p as X,l as Z,b as tt,h as J,c as et,d as nt,f as at,m as rt,Y as ot}from"./YlOrRd-BLDl4Kwt.js";import{a as st}from"./area-BAqHKHE7.js";class F extends Map{constructor(t,n=ct){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),t!=null)for(const[o,i]of t)this.set(o,i)}get(t){return super.get(U(this,t))}has(t){return super.has(U(this,t))}set(t,n){return super.set(it(this,t),n)}delete(t){return super.delete(lt(this,t))}}function U({_intern:a,_key:t},n){const o=t(n);return a.has(o)?a.get(o):n}function it({_intern:a,_key:t},n){const o=t(n);return a.has(o)?a.get(o):(a.set(o,n),n)}function lt({_intern:a,_key:t},n){const o=t(n);return a.has(o)&&(n=a.get(o),a.delete(o)),n}function ct(a){return a!==null&&typeof a=="object"?a.valueOf():a}function ut(a,t,n){a=+a,t=+t,n=(i=arguments.length)<2?(t=a,a=0,1):i<3?1:+n;for(var o=-1,i=Math.max(0,Math.ceil((t-a)/n))|0,p=new Array(i);++o<i;)p[o]=a+o*n;return p}function N(a,t){return[a,Z(tt((J+t)/2))]}N.invert=function(a,t){return[a,2*et(nt(t))-J]};function V(){return dt(N).scale(961/Q)}function dt(a){var t=Y(a),n=t.center,o=t.scale,i=t.translate,p=t.clipExtent,h=null,g,s,u;t.scale=function(e){return arguments.length?(o(e),l()):o()},t.translate=function(e){return arguments.length?(i(e),l()):i()},t.center=function(e){return arguments.length?(n(e),l()):n()},t.clipExtent=function(e){return arguments.length?(e==null?h=g=s=u=null:(h=+e[0][0],g=+e[0][1],s=+e[1][0],u=+e[1][1]),l()):h==null?null:[[h,g],[s,u]]};function l(){var e=X*o(),d=t(q(t.rotate()).invert([0,0]));return p(h==null?[[d[0]-e,d[1]-e],[d[0]+e,d[1]+e]]:a===N?[[Math.max(d[0]-e,h),g],[Math.min(d[0]+e,s),u]]:[[h,Math.max(d[1]-e,g)],[s,Math.min(d[1]+e,u)]])}return l()}const z=Symbol("implicit");function W(){var a=new F,t=[],n=[],o=z;function i(p){let h=a.get(p);if(h===void 0){if(o!==z)return o;a.set(p,h=t.push(p)-1)}return n[h%n.length]}return i.domain=function(p){if(!arguments.length)return t.slice();t=[],a=new F;for(const h of p)a.has(h)||a.set(h,t.push(h)-1);return i},i.range=function(p){return arguments.length?(n=Array.from(p),i):n.slice()},i.unknown=function(p){return arguments.length?(o=p,i):o},i.copy=function(){return W(t,n).unknown(o)},H.apply(i,arguments),i}const ht=at("4e79a7f28e2ce1575976b7b259a14fedc949af7aa1ff9da79c755fbab0ab"),pt={class:"map-card"},mt={__name:"CityEnvironmentalDotMap",setup(a){const t=M(null),n=M(null),o=M([]);let i;const p=new Intl.DateTimeFormat("en-US",{dateStyle:"medium"}),h=()=>{if(!t.value||!n.value||!o.value.length)return;const g=t.value,s=g.clientWidth;if(!s)return;const u=Math.round(s*.65),l=Math.max(1,Math.min(520,u));v(g).selectAll("*").remove();const e=v(g).append("svg").attr("width",s).attr("height",l).attr("role","img").attr("aria-label","Los Angeles city boundary with complaint dots"),d=V().fitSize([s,l],n.value),b=P(d);e.append("g").selectAll("path").data(n.value.features).join("path").attr("d",b).attr("fill","#f1f5f9").attr("stroke","#94a3b8").attr("stroke-width",.6),e.append("g").attr("class","city-outline").selectAll("path").data(n.value.features).join("path").attr("d",b).attr("fill","none").attr("stroke","#334155").attr("stroke-width",1.6).attr("stroke-linejoin","round").attr("stroke-linecap","round");const _=v(g).append("div").attr("class","tooltip").style("opacity",0),k=o.value.filter(r=>Number.isFinite(r.longitude)&&Number.isFinite(r.latitude)),A=Array.from(new Set(k.map(r=>r.category))).sort(),w=W().domain(A).range(ht.slice(0,A.length));e.append("g").attr("class","complaint-dots").attr("aria-label","Complaint locations").selectAll("circle").data(k,r=>r.id??`${r.longitude}-${r.latitude}`).join("circle").attr("cx",r=>{const c=d([r.longitude,r.latitude]);return c?c[0]:null}).attr("cy",r=>{const c=d([r.longitude,r.latitude]);return c?c[1]:null}).attr("r",3).attr("fill",r=>w(r.category)).attr("stroke","#0f172a").attr("stroke-width",.5).attr("aria-label",r=>{const c=r.date?p.format(r.date):"unknown date";return`${r.category} complaint in ${r.neighborhood??"Los Angeles"} on ${c}`}).attr("tabindex",0).on("mouseenter focus",function(r,c){v(this).raise().transition().duration(150).attr("r",5).attr("stroke-width",1.5);const[x,y]=d([c.longitude,c.latitude])??[0,0];_.style("opacity",1).style("left",`${x+12}px`).style("top",`${y+12}px`).html(`<strong>${c.category}</strong><br/>${c.neighborhood??"Los Angeles"}<br/>${c.date?p.format(c.date):"Unknown date"}`)}).on("mouseleave blur",function(){v(this).transition().duration(150).attr("r",3).attr("stroke-width",.5),_.transition().duration(150).style("opacity",0)});const j=e.append("g").attr("class","complaint-legend").attr("aria-label","Complaint categories legend").attr("transform",`translate(${Math.min(24,s*.05)}, ${Math.min(24,l*.05)})`).selectAll("g").data(A).join("g").attr("transform",(r,c)=>`translate(0, ${c*20})`);j.append("circle").attr("cx",0).attr("cy",0).attr("r",5).attr("fill",r=>w(r)).attr("stroke","#0f172a").attr("stroke-width",.5),j.append("text").attr("x",12).attr("y",4).attr("fill","#1f2937").attr("font-size",12).text(r=>r)};return D(async()=>{try{const g=new URL("/aigc-analytics-dashboard/assets/City_Boundary_wgs84-BMWn0Sew.geojson",import.meta.url),s=new URL("/aigc-analytics-dashboard/assets/complaints-C3JJk2yc.csv",import.meta.url),[u,l]=await Promise.all([fetch(g).then(e=>e.json()),I(s,e=>{const d=Number.parseFloat(e.latitude),b=Number.parseFloat(e.longitude);return!Number.isFinite(d)||!Number.isFinite(b)?null:{id:e.id,category:e.category,neighborhood:e.neighborhood,latitude:d,longitude:b,date:e.date?new Date(e.date):null}}).then(e=>e.filter(Boolean))]);n.value=u,o.value=l,h(),t.value&&(i=new ResizeObserver(()=>h()),i.observe(t.value))}catch(g){console.error("Failed to load map data:",g)}}),O(()=>{i&&t.value&&i.unobserve(t.value)}),(g,s)=>(R(),L("section",pt,[s[0]||(s[0]=f("header",{class:"map-card__header"},[f("div",null,[f("h2",{class:"h5 mb-1"},"Los Angeles City Boundary"),f("p",{class:"text-muted mb-0"}," Basemap of the Los Angeles city boundary rendered with D3. ")])],-1)),f("div",{ref_key:"chartRef",ref:t,class:"map-frame"},null,512)]))}},gt=T(mt,[["__scopeId","data-v-35890423"]]),ft={class:"map-card"},bt={__name:"LATimesNeighborhoodMap",setup(a){const t=M(null),n=M(null),o=M(new Map);let i;const p=s=>({...s,features:s.features.map(l=>{var d;if(((d=l.geometry)==null?void 0:d.type)!=="MultiPolygon")return l;const e=l.geometry.coordinates.filter(b=>st({type:"Polygon",coordinates:b})<10);return e.length&&e.length!==l.geometry.coordinates.length?{...l,geometry:{...l.geometry,coordinates:e}}:l})}),h=s=>{const u=new Map;return s.forEach(l=>{const e=l.neighborhood?l.neighborhood.trim():"";e&&u.set(e,(u.get(e)??0)+1)}),u},g=()=>{if(!t.value||!n.value)return;const s=t.value,u=s.clientWidth;if(!u)return;const l=Math.max(1,Math.min(520,Math.round(u*.75)));v(s).selectAll("*").remove();const e=v(s).append("svg").attr("width",u).attr("height",l).attr("role","img").attr("aria-label","Map of Los Angeles neighborhood boundaries"),d=V().fitSize([u,l],n.value),b=P(d),_=n.value.features??[],k=o.value,A=_.map(r=>{var m;const c=((m=r.properties)==null?void 0:m.name)??"";return k.get(c)??0}),w=rt(A),$=w&&w>0?K(ot).domain([0,w]).clamp(!0):null,j=v(s).append("div").attr("class","tooltip").style("opacity",0);if(e.append("g").attr("class","neighborhoods").selectAll("path").data(_,r=>{var c,m;return((c=r.properties)==null?void 0:c.OBJECTID)??((m=r.properties)==null?void 0:m.name)}).join(r=>r.append("path").attr("d",b).attr("fill",c=>{var x;const m=k.get(((x=c.properties)==null?void 0:x.name)??"")??0;return!$||m===0?"#e2e8f0":$(m)}).attr("stroke","#1e3a8a").attr("stroke-width",.6).attr("aria-label",c=>{var m;return`${((m=c.properties)==null?void 0:m.name)??"Neighborhood"} boundary`}).attr("tabindex",0).on("mouseenter focus",function(c,m){var B,S;v(this).raise().transition().duration(150).attr("stroke-width",1.2);const[y,C]=b.centroid(m),G=k.get(((B=m.properties)==null?void 0:B.name)??"")??0;j.style("opacity",1).style("left",`${y+12}px`).style("top",`${C+12}px`).html(`<strong>${((S=m.properties)==null?void 0:S.name)??"Neighborhood"}</strong><br/>Complaints: ${G}`)}).on("mouseleave blur",function(){v(this).transition().duration(150).attr("stroke-width",.6),j.transition().duration(150).style("opacity",0)})),e.append("g").attr("class","neighborhood-outline").selectAll("path").data(_).join("path").attr("d",b).attr("fill","none").attr("stroke","#0f172a").attr("stroke-width",.8).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("pointer-events","none"),$){const c=ut(5).map(y=>y/4*w),m=e.append("g").attr("class","choropleth-legend").attr("transform",`translate(${u-Math.min(140,u*.35)}, ${l-Math.min(160,l*.45)})`);m.append("text").attr("x",0).attr("y",0).attr("fill","#1f2937").attr("font-size",12).attr("font-weight",600).text("Complaints");const x=m.selectAll("g").data(c).join("g").attr("transform",(y,C)=>`translate(0, ${C*18+8})`);x.append("rect").attr("width",12).attr("height",12).attr("rx",2).attr("ry",2).attr("fill",y=>$(y)),x.append("text").attr("x",18).attr("y",10).attr("fill","#1f2937").attr("font-size",11).text(y=>Math.round(y).toLocaleString())}};return D(async()=>{try{const s=new URL("/aigc-analytics-dashboard/assets/LA_Times_Neighborhood_Boundaries-BcCkABjd.geojson",import.meta.url),u=new URL("/aigc-analytics-dashboard/assets/complaints-C3JJk2yc.csv",import.meta.url),[l,e]=await Promise.all([fetch(s).then(d=>d.json()),I(u,d=>({neighborhood:d.neighborhood?d.neighborhood.trim():""}))]);n.value=p(l),o.value=h(e),g(),t.value&&(i=new ResizeObserver(()=>g()),i.observe(t.value))}catch(s){console.error("Failed to load LA Times neighborhood data:",s)}}),O(()=>{i&&t.value&&i.unobserve(t.value)}),(s,u)=>(R(),L("section",ft,[u[0]||(u[0]=f("header",{class:"map-card__header"},[f("div",null,[f("h2",{class:"h5 mb-1"},"Los Angeles Neighborhoods"),f("p",{class:"text-muted mb-0"}," LA Times neighborhood boundaries rendered with D3, highlighting community names on hover. ")])],-1)),f("div",{ref_key:"chartRef",ref:t,class:"map-frame"},null,512)]))}},yt=T(bt,[["__scopeId","data-v-23c636ef"]]),vt={class:"container"},xt={class:"row g-4"},_t={class:"col-12 col-xl-6"},wt={class:"col-12 col-xl-6"},Lt={__name:"CityEnvironmentalPage",setup(a){return(t,n)=>(R(),L("div",vt,[n[0]||(n[0]=f("header",{class:"mb-4"},[f("h1",{class:"h3 fw-semibold mb-1"},"City Environmental Activity"),f("p",{class:"text-muted mb-0"}," Explore recent 311 environmental complaints across Los Angeles neighborhoods with category filtering and hover details. ")],-1)),f("section",xt,[f("div",_t,[E(gt)]),f("div",wt,[E(yt)])])]))}};export{Lt as default};
